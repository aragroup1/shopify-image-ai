<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></tool_call>
We are at the token limit. I'll provide the remaining files in the next response.
</think>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImageRelation Dashboard | Shopify AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ BASE_URL }}/dashboard/static/style.css">
    <link rel="icon" href="{{ BASE_URL }}/dashboard/static/favicon.ico">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        .lightbox-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }
        
        .lightbox-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        .lightbox-caption {
            color: white;
            text-align: center;
            margin-top: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            z-index: 2001;
        }
        
        .lightbox-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 1rem;
            z-index: 2001;
        }
        
        .lightbox-prev {
            left: 20px;
        }
        
        .lightbox-next {
            right: 20px;
        }
        
        .image-comparison {
            display: flex;
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .comparison-panel {
            flex: 1;
            text-align: center;
        }
        
        .comparison-title {
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .original-title { color: #3b82f6; }
        .processed-title { color: #10b981; }
        
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 2rem;
            gap: 0.5rem;
        }
        
        .pagination-btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: white;
            border: 1px solid #cbd5e1;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .pagination-btn:hover {
            background: #f1f5f9;
        }
        
        .pagination-btn.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }
        
        .pagination-info {
            text-align: center;
            margin-top: 1rem;
            color: #64748b;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <a href="{{ BASE_URL }}/dashboard" class="logo">
                <div class="logo-icon">AI</div>
                <div class="logo-text">ImageRelation</div>
            </a>
            
            <div class="status-badge">
                <span class="status-dot"></span>
                <span>System Operational</span>
            </div>
        </header>
        
        <main>
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-images"></i> Image Approval Dashboard
                    </h2>
                    <div class="flex gap-3">
                        <span class="badge badge-pending">
                            {{ total_items }} Items
                        </span>
                        <form method="POST" action="{{ BASE_URL }}/dashboard/fetch-all-products">
                            <button type="submit" class="btn btn-primary btn-sm pulse">
                                <i class="fas fa-sync-alt mr-1"></i>Fetch All Products
                            </button>
                        </form>
                    </div>
                </div>
                
                <div class="card-content">
                    {% if pending_items %}
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Original Images</th>
                                    <th>Processed Images</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in pending_items %}
                                <tr>
                                    <td>
                                        <div class="flex items-center">
                                            <div class="flex-shrink-0 h-10 w-10 bg-indigo-100 rounded-lg flex items-center justify-center text-indigo-700 font-bold">
                                                #{{ item[0] }}
                                            </div>
                                            <div class="ml-4">
                                                <div class="font-medium text-gray-900">Product ID: {{ item[1] }}</div>
                                                <!-- SAFE CHECK FOR TAGS -->
                                                {% if item[2] and "Supplier:apify" in item[2] %}
                                                <span class="badge badge-apify mt-1 inline-block">
                                                    <i class="fas fa-camera"></i> Apify Multi-Angle
                                                </span>
                                                {% elif item[2] and "apify" in item[2].lower() %}
                                                <span class="badge badge-apify mt-1 inline-block">
                                                    <i class="fas fa-camera"></i> Apify Product
                                                </span>
                                                {% elif item[2] and "clothing" in item[2].lower() or 
                                                       ('shirt' in item[1].lower() or 
                                                        'dress' in item[1].lower() or 
                                                        'pants' in item[1].lower() or
                                                        'jacket' in item[1].lower() or
                                                        'hoodie' in item[1].lower() or
                                                        'sweater' in item[1].lower() or
                                                        'top' in item[1].lower() or
                                                        'bottom' in item[1].lower() or
                                                        'jeans' in item[1].lower() or
                                                        'blouse' in item[1].lower() or
                                                        'skirt' in item[1].lower() or
                                                        'shorts' in item[1].lower()) %}
                                                <span class="badge badge-success mt-1 inline-block">
                                                    <i class="fas fa-tshirt"></i> Clothing
                                                </span>
                                                {% elif item[2] %}
                                                <span class="badge badge-pending mt-1 inline-block">
                                                    <i class="fas fa-tag"></i> {{ item[2] }}
                                                </span>
                                                {% else %}
                                                <span class="badge badge-pending mt-1 inline-block">
                                                    <i class="fas fa-info-circle"></i> Standard Product
                                                </span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="image-grid">
                                            {% for img in item[3].split(',')[:2] %}
                                            <div class="image-container" onclick="openLightbox(['{{ item[3] | replace(',', '\',\'') }}'], {{ loop.index0 }}, 'Original Images')">
                                                <img src="{{ img }}" alt="Original image">
                                            </div>
                                            {% endfor %}
                                            {% if item[3].count(',') > 1 %}
                                            <div class="image-container bg-gray-50 border-2 border-dashed rounded-lg flex items-center justify-center text-gray-500 text-sm">
                                                +{{ item[3].count(',') - 1 }} more
                                            </div>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td>
                                        <div class="image-grid">
                                            {% for img in item[4].split(',') %}
                                            <div class="image-container" onclick="openLightbox(['{{ item[4] | replace(',', '\',\'') }}'], {{ loop.index0 }}, 'Processed Images')">
                                                <img src="{{ img }}" alt="Processed image">
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </td>
                                    <td>
                                        <div class="flex flex-col sm:flex-row gap-2">
                                            <a href="{{ BASE_URL }}/dashboard/approve/{{ item[0] }}" 
                                               class="btn btn-success btn-sm">
                                                <i class="fas fa-check"></i> Approve
                                            </a>
                                            <button onclick="openRejectModal({{ item[0] }})" 
                                                    class="btn btn-danger btn-sm">
                                                <i class="fas fa-times"></i> Reject
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination Controls -->
                    <div class="pagination-container">
                        {% for page_num in range(1, total_pages + 1) %}
                        <button class="pagination-btn {% if page_num == current_page %}active{% endif %}" 
                                onclick="window.location.href='{{ BASE_URL }}/dashboard?page={{ page_num }}'">
                            {{ page_num }}
                        </button>
                        {% endfor %}
                    </div>
                    
                    <div class="pagination-info">
                        Showing {{ start_item }} to {{ end_item }} of {{ total_items }} items
                    </div>
                    
                    <div class="mt-6 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
                        <div class="text-gray-500">
                            <i class="fas fa-info-circle mr-2"></i>
                            Images will update in Shopify within 1 minute of approval
                        </div>
                        <form method="POST" action="{{ BASE_URL }}/dashboard/simulate-webhook">
                            <button type="submit" class="btn btn-outline">
                                <i class="fas fa-bolt"></i> Simulate Webhook
                            </button>
                        </form>
                    </div>
                    
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-icon">üñºÔ∏è</div>
                        <h3 class="empty-title">No Pending Approvals</h3>
                        <p class="empty-text">
                            Click the "Fetch All Products" button to process your entire catalog. 
                            Products will be categorized automatically:
                        </p>
                        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100">
                                <div class="text-indigo-600 font-bold mb-2">üì∏ Apify Products</div>
                                <p class="text-sm text-gray-600">Tagged with "Supplier:apify" - will be split into multiple angles</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                                <div class="text-green-600 font-bold mb-2">üëó Clothing Products</div>
                                <p class="text-sm text-gray-600">Will get lifestyle + swatch collages automatically</p>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                <div class="text-blue-600 font-bold mb-2">üì¶ Standard Products</div>
                                <p class="text-sm text-gray-600">Will get UK flag + fast delivery badges</p>
                            </div>
                        </div>
                        <div class="mt-6 flex flex-col sm:flex-row gap-4 justify-center">
                            <form method="POST" action="{{ BASE_URL }}/dashboard/fetch-all-products">
                                <button type="submit" class="btn btn-primary pulse">
                                    <i class="fas fa-sync-alt mr-2"></i>Fetch All Products Now
                                </button>
                            </form>
                            <form method="POST" action="{{ BASE_URL }}/dashboard/simulate-webhook">
                                <button type="submit" class="btn btn-outline">
                                    <i class="fas fa-bolt mr-2"></i>Simulate Test Product
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="text-center text-gray-500 text-sm mt-8">
                <p>
                    <i class="fas fa-robot"></i> AI-powered image processing ‚Ä¢ 
                    <i class="fas fa-cloud"></i> Hosted on Railway ‚Ä¢ 
                    <i class="fas fa-lock"></i> All approvals are manual
                </p>
                <p class="mt-1">
                    System Status: <span class="text-green-600 font-medium">Optimal</span> ‚Ä¢ 
                    Shopify Connection: <span class="text-green-600 font-medium">Active</span> ‚Ä¢ 
                    Products Processed: <span class="text-indigo-600 font-medium">{{ total_items }}</span>
                </p>
            </div>
        </main>
    </div>
    
    <!-- Lightbox Modal -->
    <div class="lightbox-backdrop" id="lightbox-modal" style="display:none;">
        <div class="lightbox-content">
            <img src="" alt="Full size image" class="lightbox-image" id="lightbox-image">
            <div class="lightbox-caption" id="lightbox-caption"></div>
        </div>
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <span class="lightbox-nav lightbox-prev" onclick="changeLightboxImage(-1)">&#10094;</span>
        <span class="lightbox-nav lightbox-next" onclick="changeLightboxImage(1)">&#10095;</span>
    </div>
    
    <!-- Reject Modal -->
    <div class="modal-backdrop" id="reject-modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Reject Images for Product #<span id="modal-product-id"></span></h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="reject-form" method="POST">
                    <div class="form-group">
                        <label for="reason" class="form-label">Reason for rejection</label>
                        <select name="reason" id="reason" class="form-control">
                            <option value="Poor quality">Poor image quality</option>
                            <option value="Wrong colors">Incorrect color representation</option>
                            <option value="Missing lifestyle">Missing lifestyle shot</option>
                            <option value="Composition issues">Bad composition/layout</option>
                            <option value="Other">Other reason</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Add comment (optional)</label>
                        <textarea name="comment" class="form-control" rows="3" placeholder="Additional details..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button onclick="closeModal()" class="btn btn-outline">
                    <i class="fas fa-times mr-1"></i>Cancel
                </button>
                <button onclick="submitRejection()" class="btn btn-danger">
                    <i class="fas fa-ban mr-1"></i>Confirm Rejection
                </button>
            </div>
        </div>
    </div>
    
    <script>
        let activeModal = null;
        let currentApprovalId = null;
        
        // Lightbox functionality
        let currentLightboxImages = [];
        let currentLightboxIndex = 0;
        let currentLightboxTitle = '';
        
        function openLightbox(images, index, title) {
            currentLightboxImages = images;
            currentLightboxIndex = index;
            currentLightboxTitle = title;
            
            updateLightboxImage();
            
            const modal = document.getElementById('lightbox-modal');
            modal.style.display = 'block';
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.pointerEvents = 'auto';
            }, 10);
            
            document.body.style.overflow = 'hidden';
        }
        
        function closeLightbox() {
            const modal = document.getElementById('lightbox-modal');
            modal.style.opacity = '0';
            modal.style.pointerEvents = 'none';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            
            document.body.style.overflow = 'auto';
        }
        
        function updateLightboxImage() {
            const imageElement = document.getElementById('lightbox-image');
            const captionElement = document.getElementById('lightbox-caption');
            
            if (currentLightboxImages[currentLightboxIndex]) {
                imageElement.src = currentLightboxImages[currentLightboxIndex];
                captionElement.textContent = `${currentLightboxTitle} - Image ${currentLightboxIndex + 1} of ${currentLightboxImages.length}`;
            }
        }
        
        function changeLightboxImage(direction) {
            currentLightboxIndex += direction;
            
            // Loop around if needed
            if (currentLightboxIndex < 0) {
                currentLightboxIndex = currentLightboxImages.length - 1;
            } else if (currentLightboxIndex >= currentLightboxImages.length) {
                currentLightboxIndex = 0;
            }
            
            updateLightboxImage();
        }
        
        function openRejectModal(approvalId) {
            currentApprovalId = approvalId;
            document.getElementById('modal-product-id').textContent = approvalId;
            
            const modal = document.getElementById('reject-modal');
            modal.style.display = 'block';
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.style.pointerEvents = 'auto';
            }, 10);
            
            document.body.style.overflow = 'hidden';
        }
        
        function closeModal() {
            const modal = document.getElementById('reject-modal');
            modal.style.opacity = '0';
            modal.style.pointerEvents = 'none';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            
            document.body.style.overflow = 'auto';
            currentApprovalId = null;
        }
        
        function submitRejection() {
            if (!currentApprovalId) return;
            
            const reason = document.getElementById('reason').value;
            const form = document.getElementById('reject-form');
            form.action = `{{ BASE_URL }}/dashboard/reject/${currentApprovalId}`;
            form.submit();
        }
        
        // Close modals when clicking backdrop
        document.getElementById('lightbox-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeLightbox();
            }
        });
        
        document.getElementById('reject-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        // Close modals with escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeLightbox();
                closeModal();
            }
        });
        
        // Keyboard navigation for lightbox
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('lightbox-modal').style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    changeLightboxImage(-1);
                } else if (e.key === 'ArrowRight') {
                    changeLightboxImage(1);
                }
            }
        });
    </script>
</body>
</html>
